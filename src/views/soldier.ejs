<!doctype html>
<html lang="en">

<head>
  <title>Defac Soldier Home Page</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- google fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,700" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet" />

  <!-- bootstrap css -->
  <link rel="stylesheet" href="assets/css/open-iconic-bootstrap.min.css" />
  <!-- animate css -->
  <link rel="stylesheet" href="assets/css/animate.css" />

  <!-- owl carasoul css -->
  <link rel="stylesheet" href="assets/css/owl.carousel.min.css" />
  <link rel="stylesheet" href="assets/css/owl.theme.default.min.css" />
  <!-- magnific-popup css -->
  <link rel="stylesheet" href="assets/css/magnific-popup.css" />

  <!-- aos js css -->
  <link rel="stylesheet" href="assets/css/aos.css" />

  <!-- swiper css  -->
  <link rel="stylesheet" href="https://md-aqil.github.io/images/swiper.min.css" />

  <!-- ionicon css -->
  <link rel="stylesheet" href="assets/css/ionicons.min.css" />

  <!-- bootstrapdate picker and time picker -->
  <link rel="stylesheet" href="assets/css/bootstrap-datepicker.css" />
  <link rel="stylesheet" href="assets/css/jquery.timepicker.css" />

  <!-- flaticon css -->
  <link rel="stylesheet" href="assets/css/flaticon.css" />
  <!-- icomoon icon css -->
  <link rel="stylesheet" href="assets/css/icomoon.css" />
  <!-- custom css -->
  <link rel="stylesheet" href="assets/css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

  <%- include('partials/auth-check') %>
</head>

<body>
  <!-- ==============================================
     menu bar or navbar here
     ================================================== -->
  <%- include('partials/soldier-nav') %>

    <!-- END nav -->
    <!-- ==============================================
     menu bar or navbar here
     ================================================== -->

    <!-- =============================================
      Banner slider or owl carasoul here
      ================================================= -->
    <section id="banner">
    </section>
    <!-- =============================================
      Banner slider or owl carasoul here
      ================================================= -->

    <!-- =============================================
       highlight contact us points here 
       ================================================= -->
    <section class="ftco-intro">
      <div class="container-wrap">
        <div class="wrap d-md-flex align-items-xl-end">
          <div class="info">
            <div class="row no-gutters">
              <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                <div class="icon">
                  <span class="icon-phone"><i class="fa-solid fa-phone"></i></span>
                </div>
                <div class="text">
                  <h3>Contact Us</h3>
                  <p>000 (123) 456 7890</p>
                </div>
              </div>
              <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                <div class="icon"><span class="icon-my_location"></span></div>
                <div class="text">
                  <h3>Our Address</h3>
                  <p>Fort Stewart, GA, USA</p>
                </div>
              </div>
              <div class="col-md-4 d-flex ftco-animate fadeInUp ftco-animated">
                <div class="icon"><span class="icon-clock-o"></span></div>
                <div class="text">
                  <h3>Opening Hours</h3>
                  <p>06:00am - 06:00pm</p>
                </div>
              </div>
            </div>
          </div>
          <div class="book p-4"></div>
        </div>
      </div>
    </section>
    <!-- =============================================
       highlight contact us points here 
       ================================================= -->

    <!-- ============================================
        About us here
        =============================================== -->
    <section class="ftco-about d-md-flex">
      <div class="one-half img" id="about-image"></div>
      <div class="one-half ftco-animate">
        <div class="overlap">
          <div class="heading-section ftco-animate">
            <span class="subheading">Discover</span>
            <h2 class="mb-4">About Us</h2>
          </div>
          <div>
            <p class="text-white">
              Food is more than just sustenance; it is a delightful experience
              that brings people together and nourishes both the body and the
              soul. The sheer variety of flavors, textures, and aromas that food
              offers is truly remarkable.
            </p>
          </div>
        </div>
      </div>
    </section>
    <!-- ============================================
        About us here
        =============================================== -->

    <!-- =============================================
   Photo Gallery here
   ================================================= -->
    <section class="ftco-gallery">
      <div class="container-wrap">
        <div class="row no-gutters" id="gallery-images">
        </div>
      </div>
    </section>
    <!-- =============================================
     Photo Gallery here
     ================================================= -->

    <!-- =======================================
	  Discover Our Menu htl starts here
	  =========================================== -->
    <section class="ftco-menu">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-7 heading-section text-center ftco-animate">
            <span class="subheading">Discover</span>
            <h2 class="mb-4">Our Menu</h2>
          </div>
        </div>
        <div class="row d-md-flex">
          <div class="col-lg-12 ftco-animate p-md-3">
            <div class="row">
              <div class="col-md-12 nav-link-wrap mb-5">
                <div class="nav ftco-animate nav-pills justify-content-center" id="v-pills-tab" role="tablist"
                  aria-orientation="vertical">
                  <a class="nav-link active" id="v-pills-1-tab" data-toggle="pill" href="#v-pills-1" role="tab"
                    aria-controls="v-pills-1" aria-selected="true">Breakfast</a>

                  <a class="nav-link" id="v-pills-2-tab" data-toggle="pill" href="#v-pills-2" role="tab"
                    aria-controls="v-pills-2" aria-selected="false">Lunch</a>

                  <a class="nav-link" id="v-pills-3-tab" data-toggle="pill" href="#v-pills-3" role="tab"
                    aria-controls="v-pills-3" aria-selected="false">Dinner</a>
                </div>
              </div>
              <div class="col-md-12">
                <div class="tab-content ftco-animate" id="v-pills-tabContent">
                  <div class="tab-pane fade show active" id="v-pills-1" role="tabpanel" aria-labelledby="v-pills-1-tab">
                    <!-- <div class="text text-center">
                      <h4>Our Breakfast Timing</h4>
                      <p>7:00am - 9:00am</p>
                    </div> -->
                    <div class="row" id="breakfast">
                    </div>
                  </div>

                  <div class="tab-pane fade" id="v-pills-2" role="tabpanel" aria-labelledby="v-pills-2-tab">
                    <!-- <div class="text text-center">
                      <h4>Our Lunch Timing</h4>
                      <p>02:00pm - 04:00pm</p>
                    </div> -->
                    <div class="row" id="lunch">
                    </div>
                  </div>

                  <div class="tab-pane fade" id="v-pills-3" role="tabpanel" aria-labelledby="v-pills-3-tab">
                    <!-- <div class="text text-center">
                      <h4>Our Dinner Timimg</h4>
                      <p>05:00pm - 07:00pm</p>
                    </div> -->
                    <div class="row" id="dinner">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- =======================================
	  Discover Our Menu htl ends here
	  =========================================== -->

    <!-- =======================================
     Defac information here
     =========================================== -->
    <section class="main-defac">
      <div class="container">
        <div class="heading-section text-center ftco-animate fadeInUp ftco-animated">
          <span class="subheading">Discover</span>
          <h2 class="mb-4">Our Defac</h2>
        </div>
        <div id="defac-list">
        </div>
    </section>
    <!-- =======================================
     Defac information here
     =========================================== -->

    <!-- =============================================
	 Upcoming Events html starts here 
	 ================================================= -->
    <section class="ftco-section">
      <div class="container">
        <div class="row justify-content-center mb-5 pb-3">
          <div class="col-md-7 heading-section ftco-animate text-center">
            <span class="subheading">Discover</span>
            <h2 class="mb-4">Upcoming Events</h2>
          </div>
        </div>
        <div class="row d-flex" id="event-list">
        </div>
      </div>
    </section>
    <!-- =============================================
 Upcoming Events html ends here 
 ================================================= -->

    <!-- ================================================
   Feedback or testimonials here
   ==================================================== -->
    <section class="spacer">
      <div class="container">
        <div class="row justify-content-center mb-5">
          <div class="col-md-7 heading-section text-center ftco-animate fadeInUp ftco-animated">
            <span class="subheading">Testimony</span>
            <h2 class="mb-4">Soldier Says</h2>
            <p>
              Here are several reviews from our soldiers regarding their
              experiences with the canteen:
            </p>
          </div>
        </div>
        <div class="testimonial-section" id="testimonial">
          <div class="testi-user-img" id="image-slider">
          </div>
          <div class="user-saying" id="testimonial-slider">
          </div>
        </div>
      </div>
    </section>
    <!-- ================================================
     Feedback or testimonials here
     ==================================================== -->

    <!-- =====================================
     footer part here
     ========================================= -->
    <%- include('partials/footer') %>
      <!-- =====================================
     footer part here
     ========================================= -->

      <!-- ======================================
	 loader
	 ========================================== -->
      <div id="ftco-loader" class="show fullscreen">
        <svg class="circular" width="48px" height="48px">
          <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
          <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
            stroke="#587440" />
        </svg>
      </div>
      <!-- ======================================
	 loader
	 ========================================== -->

      <!-- javascripts cdn here -->
      <script src="assets/js/jquery.min.js"></script>
      <script src="assets/js/jquery-migrate-3.0.1.min.js"></script>
      <script src="assets/js/popper.min.js"></script>
      <script src="assets/js/bootstrap.min.js"></script>
      <script src="assets/js/jquery.easing.1.3.js"></script>
      <script src="assets/js/jquery.waypoints.min.js"></script>
      <script src="assets/js/jquery.stellar.min.js"></script>
      <script src="assets/js/owl.carousel.min.js"></script>
      <script src="assets/js/jquery.magnific-popup.min.js"></script>
      <script src="assets/js/aos.js"></script>
      <script src="assets/js/jquery.animateNumber.min.js"></script>
      <script src="assets/js/bootstrap-datepicker.js"></script>
      <script src="assets/js/jquery.timepicker.min.js"></script>
      <script src="assets/js/scrollax.min.js"></script>
      <script src="https://md-aqil.github.io/images/swiper.min.js"></script>
      <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
      <script src="assets/js/google-map.js"></script>
      <script src="assets/js/star-rating.js"></script>

      <script src="assets/js/main.js"></script>
      <script>
        let menuList = []
        let eventList = []
        let feedbackList = []
        let defacList = []
        let bannerList = []
        let galleryImages = []
        window.onload = function () {
          fetchMenu();
          fetchEvent();
          fetchDefac();
          fetchFeedback();
          fetchBannerData();
          fetchGalleryImage();
        };

        const fetchBannerData = async () => {
          try {
            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);

            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(`${serverUrl}/api/banner`, requestOptions);
            const result = await response.json();
            if (result?.statusCode === '10000') {
              bannerList = result.data;
              renderBannerData();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        };

        const renderBannerData = () => {
        const bannerUI = document.getElementById('banner');
        bannerUI.innerHTML = `
  <div class="home-slider owl-carousel">
    ${bannerList
      ?.map((banner) => {
        return `
        <div class="slider-item" style="background-image: url(${banner.bannerUrl})">
          <div class="overlay"></div>
          <div class="container">
            <div class="row slider-text justify-content-center align-items-center">
              <div class="col-md-8 col-sm-12 text-center ftco-animate">
                <span class="subheading">Welcome To Defac App</span>
                <h1 class="mb-4">
                  ${banner.title}
                </h1>
              </div>
            </div>
          </div>
        </div>
      `;
      })
      .join('')} <!-- Added join('') here -->
  </div>
`;

        // for slider
        $('.home-slider').owlCarousel({
          loop: true,
          autoplay: true,
          margin: 0,
          animateOut: 'fadeOut',
          animateIn: 'fadeIn',
          nav: false,
          autoplayHoverPause: false,
          items: 1,
          navText: [
            "<span class='ion-md-arrow-back'></span>",
            "<span class='ion-chevron-right'></span>",
          ],
          responsive: {
            0: {
              items: 1,
              nav: false,
            },
            600: {
              items: 1,
              nav: false,
            },
            1000: {
              items: 1,
              nav: false,
            },
          },
        });

        // for animation
        contentWayPoint();
      };

        const fetchGalleryImage = async () => {
          try {
            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);

            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(`${serverUrl}/api/gallery`, requestOptions);
            const result = await response.json();
            if (result?.statusCode === '10000') {
              galleryImages = result.data;
              renderGallery();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        }

        const renderGallery = () => {
          const aboutImage = document.getElementById('about-image')
          aboutImage.style.backgroundImage = `url('${galleryImages[0].galleryUrl}')`;

          const gallery = document.getElementById('gallery-images')
          gallery.innerHTML = galleryImages?.slice(1, 5)?.map((image) => {
            return `
            <div class="col-md-3 ftco-animate">
          <a href="#" class="gallery img d-flex align-items-center"
            style="background-image: url('${image.galleryUrl}')">
            <div class="icon mb-4 d-flex align-items-center justify-content-center">
              <span class="icon-search"></span>
            </div>
          </a>
        </div>
            `
          }).join('')

          // for text visibility and animation
          contentWayPoint();
        }


        const fetchMenu = async () => {
          try {
            const accessToken = window.localStorage.getItem('accessToken')
            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);
            myHeaders.append('Authorization', `Bearer ${accessToken}`);

            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(
              `${serverUrl}/api/menu/defac`,
              requestOptions,
            );
            const result = await response.json();
            if (result?.statusCode === '10000') {
              menuList = result.data.menuList
              renderMenuList();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        }

        const renderMenuList = () => {
          const breakfast = document.getElementById('breakfast')
          const lunch = document.getElementById('lunch')
          const dinner = document.getElementById('dinner')

          const breakFastMenu = menuList?.filter((food) => food.category.toLowerCase() === 'breakfast')
          const lunchMenu = menuList?.filter((food) => food.category.toLowerCase() === 'lunch')
          const dinnerMenu = menuList?.filter((food) => food.category.toLowerCase() === 'dinner')

          breakfast.innerHTML = breakFastMenu.length > 0 ? breakFastMenu?.map(renderFood).join('') : `<div style="text-align: center; font-size: 20px; font-weight: 500; color: white; width: 100%;">No menu found</div>`
          lunch.innerHTML = lunchMenu.length > 0 ? lunchMenu?.map(renderFood).join('') : `<div style="text-align: center; font-size: 20px; font-weight: 500; color: white; width: 100%;">No menu found</div>`
          dinner.innerHTML = dinnerMenu.length > 0 ? dinnerMenu?.map(renderFood).join('') : `<div style="text-align: center; font-size: 20px; font-weight: 500; color: white; width: 100%;">No menu found</div>`
        }

        const renderFood = (menu, id) => {
          return `<div class="col-md-4 text-center">
                        <div class="menu-wrap">
                          <a href="#" class="menu-img img mb-4" style="
                              background-image: url(${menu.menuUrl}); background-position: top center;
                            "></a>
                          <div class="text">
                            <h3><a href="#">${menu.name}</a></h3>
                            <p>
                            ${menu.description}
                            </p>
                          </div>
                        </div>
                      </div>`
        }

        const fetchEvent = async () => {
          try {
            const accessToken = window.localStorage.getItem('accessToken')
            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);
            myHeaders.append('Authorization', `Bearer ${accessToken}`);

            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(
              `${serverUrl}/api/event/defac`,
              requestOptions,
            );
            const result = await response.json();
            if (result?.statusCode === '10000') {
              eventList = result.data.eventList
              renderEventList();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        }

        const renderEventList = () => {
          const eventUI = document.getElementById('event-list')
          eventUI.innerHTML = eventList?.length > 0 ? eventList?.map((event, id) => {
            return `
          <div class="col-md-4 d-flex">
            <div class="blog-entry align-self-stretch">
              <a href="" class="block-20" style="background-image: url('${event.eventUrl}');background-size: contain; background-position: center; background-repeat: no-repeat;">
              </a>
              <div class="text py-4 d-block">
                <div class="meta">
                  <div><a href="#">${moment(event.startDate).format('MMM D, YYYY h:mm A')}</a></div>
                  <div><a href="#">/ ${event.defac.name}</a></div>
                </div>
                <h3 class="heading mt-2">
                  <a href="/soldier-event-detail?id=${event._id}">${event.name}</a>
                </h3>
                <p>
                  ${event.description}
                </p>
              </div>
            </div>
          </div>`
          }).join('') : `<div style="text-align: center; font-size: 20px; font-weight: 500; color: white; width: 100%;">No event found</div>`

        }

        const fetchDefac = async () => {
          try {

          const accessToken = window.localStorage.getItem('accessToken');

            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);
            myHeaders.append('Authorization', `Bearer ${accessToken}`);


            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(
              `${serverUrl}/api/defac/soldier`,
              requestOptions,
            );
            const result = await response.json();
            if (result?.statusCode === '10000') {
              defacList = result.data.updatedDefacList
              renderDefacList();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        }

        const renderDefacList = () => {
          const defacUI = document.getElementById('defac-list')
          defacUI.innerHTML = `
          <div class="box-area">
            ${defacList?.map((defac, id) => {
            return `
          <div class="box ${id === 0 ? 'active' : ''}">
            <img src="${defac.coverPicUrl}" alt="cover picture" />
            <div class="defac-logo">
              <img src="${defac.profilePicUrl}" alt="profile picture" style="border-radius: 50%; object-position: top;" />
            </div>
            <div class="defac-name-tag">
              <h2>${defac.name}</h2>
              <a href="/defac-detail?id=${defac._id}" style="color: yellow; text-decoration: underline;">View Details</a>
              <div class="rating-time">
                ${(defac.rating !== undefined && defac.rating !== null) ? `<p><i class="icon-star"></i>${defac.rating}</p>` : ``}
                <p><span class="icon-clock-o"></span> ${defac.openingHour} - ${defac.closingHour}</p>
              </div>
            </div>
          </div>`
          })}
            </div>
        `

          $(".box").click(function () {
            $(".box").removeClass("active");
            $(this).addClass("active");
          });
        }

        const fetchFeedback = async () => {
          try {
            const accessToken = window.localStorage.getItem('accessToken')
            const apiKey = '<%= apiKey %>';
            const serverUrl = '<%= serverUrl %>';
            const myHeaders = new Headers();
            myHeaders.append('x-api-key', apiKey);
            myHeaders.append('Authorization', `Bearer ${accessToken}`);

            const requestOptions = {
              method: 'GET',
              headers: myHeaders,
              redirect: 'follow',
            };

            const response = await fetch(
              `${serverUrl}/api/feedback/defac`,
              requestOptions,
            );
            const result = await response.json();
            if (result?.statusCode === '10000') {
              feedbackList = result.data.feedbackList
              renderFeedback();
            } else {
              alert('Failed to fetch data: ' + result.message);
            }
          } catch (err) {
            console.error(err);
          }
        }

        const renderFeedback = () => {
        const imageSlider = document.getElementById('image-slider');
        const images = feedbackList?.map(
          (feedback) => feedback.postedBy.profilePicUrl,
        );
        imageSlider.innerHTML = `
    <div class="swiper-container gallery-thumbs">
      <div class="swiper-wrapper">
        ${images
          ?.map((image, id) => {
            return `<div class="swiper-slide">
            <img src="${image}" alt="image-${id + 1}" />
          </div>`;
          })
          .join('')} <!-- Join the mapped array here -->
      </div>
    </div>`;

        const testimonialSlider = document.getElementById('testimonial-slider');
        testimonialSlider.innerHTML = `
    <div class="swiper-container testimonial">
      <div class="swiper-wrapper">
        ${feedbackList
          ?.map((feedback) => {
            return `
          <div class="swiper-slide">
            <div class="quote">
              <img class="quote-icon" src="./assets/images/quotes.png" alt="" />
              <p>
                ${feedback.feedback}
              </p>
              <div class="name">${feedback.postedBy.name}</div>
              <div class="designation">${feedback.postedBy.post}</div>
            </div>
          </div>`;
          })
          .join('')} <!-- Join the mapped array here -->
      </div>
      <div class="swiper-pagination swiper-pagination-white"></div>
    </div>`;

        var galleryThumbs = new Swiper('.gallery-thumbs', {
          effect: 'coverflow',
          grabCursor: true,
          centeredSlides: true,
          slidesPerView: '2',

          coverflowEffect: {
            rotate: 0,
            stretch: 0,
            depth: 50,
            modifier: 6,
            slideShadows: false,
          },
        });

        var galleryTop = new Swiper('.swiper-container.testimonial', {
          speed: 400,
          spaceBetween: 50,
          autoplay: {
            delay: 3000,
            disableOnInteraction: false,
          },
          direction: 'vertical',
          pagination: {
            clickable: true,
            el: '.swiper-pagination',
            type: 'bullets',
          },
          thumbs: {
            swiper: galleryThumbs,
          },
        });
      };

        // for text visibility and animation
        var contentWayPoint = function () {
          var i = 0;
          $('.ftco-animate').waypoint(
            function (direction) {
              if (
                direction === 'down' &&
                !$(this.element).hasClass('ftco-animated')
              ) {
                i++;

                $(this.element).addClass('item-animate');
                setTimeout(function () {
                  $('body .ftco-animate.item-animate').each(function (k) {
                    var el = $(this);
                    setTimeout(
                      function () {
                        var effect = el.data('animate-effect');
                        if (effect === 'fadeIn') {
                          el.addClass('fadeIn ftco-animated');
                        } else if (effect === 'fadeInLeft') {
                          el.addClass('fadeInLeft ftco-animated');
                        } else if (effect === 'fadeInRight') {
                          el.addClass('fadeInRight ftco-animated');
                        } else {
                          el.addClass('fadeInUp ftco-animated');
                        }
                        el.removeClass('item-animate');
                      },
                      k * 50,
                      'easeInOutExpo',
                    );
                  });
                }, 100);
              }
            },
            { offset: '95%' },
          );
        };

      </script>
</body>

</html>